<!-- Right side column. Contains the navbar and content of the page -->
<!-- Content Header (Page header) -->

<section class="content-header">
  <h1>
    <small></small>
  </h1>
  <ol class="breadcrumb">
    <li><a href="#"><i class="fa fa-dashboard"></i> {{'statisticalAnalysis'|translate}}</a></li>
    <li class="active">{{'longTimeNotConnectedDevices'|translate}}</li>
  </ol>
</section>


<!-- Main content -->
<section class="content form-horizontal">

  <div class="row form-group">
    <div class="col-md-2">
      <label class="control-label">{{'theLastConnectionDeadline'|translate}}</label>
    </div>
    <div class="col-md-3">
      <p class="input-group">
        <input type="text" class="form-control" uib-datepicker-popup="{{formatCustom}}" ng-model="idleDeviceCtrl.dataUploadDate" is-open="idleDeviceCtrl.dataUploadDateOpenStatus.opened" datepicker-options="idleDeviceCtrl.dateOptions" min-date="idleDeviceCtrl.minDate" max-date="idleDeviceCtrl.maxDate" ng-required="true" current-text="{{'today'|translate}}" clear-text="{{'cleanUp'|translate}}" close-text="{{'close'|translate}}" />
          <span class="input-group-btn">
            <button type="button" class="btn btn-default" ng-click="idleDeviceCtrl.dataUploadDateOpen($event)"><i class="glyphicon glyphicon-calendar"></i></button>
          </span>
      </p>
    </div>

    <div class="col-md-offset-4 col-md-3 text-right">
      <button class="btn btn-primary" type="button" ng-click="idleDeviceCtrl.reset()">{{'reset'|translate}}</button>
      <button class="btn btn-primary" type="button" presentation-href="statAnalysis:machine:longTimeOffline:query" ng-click="idleDeviceCtrl.query(null,null,null,idleDeviceCtrl.dataUploadDate)">{{'query'|translate}}</button>
      <a class="btn btn-default"  title="Export Table" ng-click='idleDeviceCtrl.excelExport(idleDeviceCtrl.dataUploadDate)' presentation-href="statAnalysis:machine:longTimeOffline:export">{{'export'|translate}}</a>
    </div>
  </div>

  <div class="row form-group">
    <div class="btn-group col-md-3">
      <span class="label label-info pull-left">{{'rentalTotal'|translate}}:{{idleDeviceCtrl.page.totalElements}}</span>
    </div>
  </div>

  <div class="table-responsive">
    <table ng-table="idleDeviceCtrl.tableParams" class="table table-condensed table-bordered table-striped text-nowrap">
      <tr ng-repeat="device in $data">
        <td class="text-nowrap" data-title="'deviceNum'|translate" sortable="'deviceNum'">{{device.deviceNum}}</td>
        <td class="text-nowrap" data-title="'vehicleNumber'|translate" sortable="'machine.licenseId'">{{device.machine.licenseId}}</td>
        <td class="text-nowrap" data-title="'SIMCardNumber'|translate" sortable="'sim.phoneNumber'">{{device.sim.phoneNumber}}</td>
        <td class="text-nowrap" data-title="'totalRunningTimeHour'|translate" sortable="'totalDuration'">{{device.totalDuration * 0.05 | convertToMins}}</td>

        <td class="text-nowrap" ng-if="device.ecuLockStatus != null && device.ecuLockStatus.substr(7,1)=='0'" data-title="'ecuLockStatus'|translate" sortable="'ecuLockStatus'">{{'inactivated'|translate}}</td>
        <td class="text-nowrap" ng-if="device.ecuLockStatus != null && device.ecuLockStatus.substr(7,1)!='0'" data-title="'ecuLockStatus'|translate" sortable="'ecuLockStatus'">{{'activated'|translate}}</td>
        <td class="text-nowrap" ng-if="device.ecuLockStatus == null" data-title="'ecuLockStatus'|translate" sortable="'ecuLockStatus'">-</td>

        <td class="text-nowrap" ng-if="device.commStatus=='10'" data-title="'CANcommunicationStatus'|translate" sortable="'commStatus'">{{'notWork'|translate}}</td>
        <td class="text-nowrap" ng-if="device.commStatus=='01'" data-title="'CANcommunicationStatus'|translate" sortable="'commStatus'">{{'work'|translate}}</td>
        <td class="text-nowrap" ng-if="device.commStatus!='10' && device.commStatus!='01'" data-title="'CANcommunicationStatus'|translate" sortable="'commStatus'">-</td>

        <td class="text-nowrap" data-title="'GPRSSignalQuality'|translate" sortable="'gsmSignal'">{{(device.gsmSignal*100/31) | number:0}}%</td>
        <td class="text-nowrap" data-title="'numberOfStarts'|translate" sortable="'startTimes'">{{device.startTimes}}</td>

        <td class="text-nowrap" ng-if="device.versionNum!='40' && device.lockStatus=='00'" data-title="'lockedCarStatus'|translate" sortable="'lockStatus'">{{'rentalValid'|translate}}</td>
        <td class="text-nowrap" ng-if="device.versionNum!='40' && device.lockStatus=='01'" data-title="'lockedCarStatus'|translate" sortable="'lockStatus'">{{'one-level'|translate}}</td>
        <!--锁车时候显示“二级”更改为“锁车”-->
        <td class="text-nowrap" ng-if="device.versionNum!='40' && device.lockStatus=='10'" data-title="'lockedCarStatus'|translate" sortable="'lockStatus'">{{'lockYourCar'|translate}}</td>
        <td class="text-nowrap" ng-if="device.versionNum!='40' && device.lockStatus!='00' && device.lockStatus!='01' && device.lockStatus!='10'" data-title="'lockedCarStatus'|translate" sortable="'lockStatus'">-</td>
        <!--中挖的锁车状态要根据GPRS信号百分比确定，90为锁车，其它为未锁车  by 薛庆鹏 2017-1-3&ndash;&gt;-->
        <td class="text-nowrap" ng-if="device.versionNum=='40' && device.gprsSignal=='90'" data-title="'lockedCarStatus'|translate" sortable="'gprsSignal'">{{'lockYourCar'|translate}}</td>
        <td class="text-nowrap" ng-if="device.versionNum=='40' && device.gprsSignal!='90'" data-title="'lockedCarStatus'|translate" sortable="'gprsSignal'">{{'rentalValid'|translate}}</td>

        <td class="text-nowrap" ng-if="device.lockerStatus=='00'" data-title="'openCoverState'|translate" sortable="'lockerStatus'">{{'notOpen'|translate}}</td>
        <td class="text-nowrap" ng-if="device.lockerStatus=='11'" data-title="'openCoverState'|translate" sortable="'lockerStatus'">{{'openCover'|translate}}</td>
        <td class="text-nowrap" ng-if="device.lockerStatus!='00' && device.lockerStatus!='11'" data-title="'openCoverState'|translate" sortable="'lockerStatus'">-</td>

        <td class="text-nowrap" ng-if="device.bindMachineId!=null" data-title="'actualBindingVIN'|translate" sortable="'bindMachineId'">{{device.bindMachineId}}</td>
        <td class="text-nowrap" ng-if="device.bindMachineId==null" data-title="'actualBindingVIN'|translate" sortable="'bindMachineId'"></td>
        <td class="text-nowrap" data-title="'theLatestUploadTime'|translate" sortable="'lastDataUploadTime'">{{device.lastDataUploadTime | date:'yyyy-MM-dd HH:mm:ss'}}</td>
        <td class="text-nowrap" data-title="'signalFreeDuration'|translate" sortable="'lastDataUploadTime'">{{(idleDeviceCtrl.queryTime - device.lastDataUploadTime)/3600000 | convertToMins}}</td>
      </tr>
    </table>
  </div>

  <div class="box-footer">
    <uib-pagination total-items="idleDeviceCtrl.page.totalElements"
                    ng-change="idleDeviceCtrl.query(idleDeviceCtrl.pageNumber-1,null,null,idleDeviceCtrl.dataUploadDate)"
                    max-size="5" ng-model="idleDeviceCtrl.pageNumber" items-per-page="idleDeviceCtrl.page.size"
                    class="pagination-sm" boundary-links="true" rotate="false"
                    first-text="{{'pagingHomePage' | translate}}" last-text="{{'lastPage'|translate}}" next-text="{{'nextPage'|translate}}" previous-text="{{'previousPage'|translate}}"></uib-pagination>
  </div>

</section>

