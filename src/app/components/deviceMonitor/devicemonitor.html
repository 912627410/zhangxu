<style type="text/css">
  .angular-google-map-container {
    position: absolute;
    top: 0;
    bottom: 0;
    right: 0;
    left: 0;
    min-height: 500px;
  }
</style>
<section class="content-header">
  <h1>
    {{'equipmentMonitoring'|translate}}
    <small></small>
  </h1>
  <ol class="breadcrumb">
    <li><a href="#"><i class="fa fa-dashboard"></i> {{'homePage'|translate}}</a></li>
    <li class="active"> {{'equipmentMonitoring'|translate}}</li>
  </ol>
</section>

<!-- Main content -->
<section class="content form-horizontal">


  <!-- 高德地图 -->
  <div class = "row">
    <div class="col-xs-12 connectedSortable">
      <div class="box box-danger">
        <div class="box-header text-center">
          <!-- tools box -->
          <div class="pull-right box-tools">
            <button class="btn btn-danger btn-sm refresh-btn" data-toggle="tooltip" ng-click="monitorCtrl.refreshMainMap()" title="{{'refresh'|translate}}"><i class="fa fa-refresh"></i></button>
          </div><!-- /. tools -->
          <h3 class="box-title">{{'lastReturn100'|translate}}</h3>
        </div><!-- /.box-header -->
        <div style="position: relative;">
          <div class="box-body" style="min-height: 500px" id="monitorMap"></div>
          <div ng-if="userInfo!=null && userInfo.userdto.countryCode!='ZH'" ng-controller="HomeMapController as homeMapCtrl">
            <ui-gmap-google-map center="homeMapCtrl.map.center" zoom="homeMapCtrl.map.zoom" draggable="false"
                                options="homeMapCtrl.map.options">
              <ui-gmap-markers models="homeMapCtrl.map.markers" coords="'self'" icon="'icon'">
                <ui-gmap-windows show="show">
                  <div ng-non-bindable>
                    <div class="info" style="border: none;">
                      <div class="info-top" style="background: none;">
                        <div>{{deviceNum}}</div>
                      </div>
                      <div class="info-middle" style="background-color: white;">
                        经度: {{latitude}}<br>
                        纬度: {{longitude}}<br>
                        当前位置:{{address}}<br>
                        更新时间:{{lastDataUploadTime}}<br>
                      </div>
                    </div>
                  </div>
                </ui-gmap-windows>
              </ui-gmap-markers>
            </ui-gmap-google-map>
          </div>
        </div>


      </div>
    </div><!-- /.col -->
  </div>


  <div class="row form-group">
    <hr>
    <div class="col-md-1">
      <label class="control-label">{{'terminalno'|translate}}:</label>
    </div>
    <div class="col-md-2">
      <input type="text" name="queryDeviceNum" class="form-control " ng-model="monitorCtrl.queryDeviceNum" ng-keyup="$event.keyCode == 13 ? monitorCtrl.queryDeviceInfo(0,null,null,monitorCtrl.device) : null"
             placeholder="{{'supportfuzzyqueries'|translate}}"/>
    </div>
    <div class="col-md-1">
      <label class="control-label">{{'machineNumberAndCarNumber'|translate}}:</label>
    </div>
    <div class="col-md-2">
      <input type="text" name="queryMachineLicenseId" class="form-control " ng-model="monitorCtrl.queryMachineLicenseId" ng-keyup="$event.keyCode == 13 ? monitorCtrl.queryDeviceInfo(0,null,null,monitorCtrl.device) : null" placeholder="{{'supportfuzzyqueries'|translate}}"/>
    </div>
    <div class="col-md-1">
      <label class="control-label">{{'organisation'|translate}}:</label>
    </div>
    <div class="col-md-2">
      <p class="input-group">
        <input type="text" id="org" class="form-control" placeholder="{{'organisation'|translate}}"
               ng-model="monitorCtrl.queryOrg.label" name="org" readonly required/>
        <span class="input-group-btn">
                  <!--打开组织树-->
                  <button type="button" class="btn btn-default" ng-click="monitorCtrl.openTreeInfo()">
                    <i class="fa fa-sitemap"></i>
                  </button>
                  </span>
      </p>
    </div>
    <div class="col-md-3">
      <label class="control-label">{{'subordinateOrganization'|translate}}:</label>
      <input type="checkbox" checked="checked" ng-model="monitorCtrl.querySubOrg"/>
    </div>


  </div>

    <!--<div class=" row form-group">
      <div class="col-md-1">
        <label class="control-label right">{{'brandType'|translate}}:</label>
      </div>
      <div class="col-md-2">
        <select name="deviceMF" class="form-control"
                ng-model="monitorCtrl.queryManufacture"
                ng-options="deviceManufacture.id as deviceManufacture.name for deviceManufacture in monitorCtrl.deviceManufactureList">
          <option value="">{{'pleaseSelect'|translate}}</option>
        </select>
      </div>
      <div class="col-md-1">
        <label class="control-label right">{{'driveType'|translate}}:</label>
      </div>
      <div class="col-md-2">
        <select name="devicePowerType" class="form-control"
                ng-model="monitorCtrl.queryDevicePowerType"
                ng-options="devicePowerType.id as devicePowerType.name for devicePowerType in monitorCtrl.devicePowerTypeList">
          <option value="">{{'pleaseSelect'|translate}}</option>
        </select>
      </div>
      <div class="col-md-1">
        <label class="control-label right">{{'highlyType'|translate}}:</label>
      </div>
      <div class="col-md-2">
        <select name="deviceMF" class="form-control"
                ng-model="monitorCtrl.queryDeviceHeightType"
                ng-options="deviceHeightType.id as deviceHeightType.name for deviceHeightType in monitorCtrl.deviceHeightTypeList">
          <option value="">{{'pleaseSelect'|translate}}</option>
        </select>
      </div>
      <div class="col-md-2">
      </div>
    </div>-->


  <div class="row form-group">

    <div class="col-md-1">
      <label class="control-label">{{'deviceType'|translate}}:</label>
    </div>
    <div class="col-md-2">
      <select class="form-control" ng-model="monitorCtrl.queryDeviceType">
        <option value="A1">{{'smallExcavator'|translate}}</option>
        <option value="2,3,30,1001">{{'oreMachine'|translate}}</option>
        <option value="40">{{'mediumExcavator'|translate}}</option>
        <option value="1">{{'loader'|translate}}</option>
        <option value="A001">{{'arialVehicle'|translate}}</option>
      </select>
    </div>
    <div class="col-md-offset-7 col-md-2">
      <button class="btn btn-warning" type="button" ng-click="monitorCtrl.reset()">{{'reset'|translate}}</button>
      <button class="btn btn-primary" type="button" presentation-href="device:monitorPage" ng-click="monitorCtrl.queryDeviceInfo(0,null,null,monitorCtrl.device)">{{'query'|translate}}</button>
    </div>
  </div>
  <div class="row">
    <hr>
    <div class="btn-group col-md-2">
      <label class="btn btn-default btn-xs" ng-model="monitorCtrl.radioListType" uib-btn-radio="'list'" uncheckable>{{'list'|translate}}</label>
      <label class="btn btn-default btn-xs" ng-model="monitorCtrl.radioListType" uib-btn-radio="'block'" uncheckable>{{'columnBlock'|translate}}</label>
    </div>
    <div class="btn-group col-md-2">
      <span>{{'totalNumberOfRecords'|translate}} {{monitorCtrl.page.totalElements}}</span>
    </div>
    <div class="btn-group col-md-8 right">
      <a class="btn btn-default pull-right"  ng-click="monitorCtrl.excelExport(monitorCtrl.queryOrg)">{{'export'|translate}}</a>
    </div>
  </div>



  <div class="row" style="padding: 10px">
    <!--列块模式-->
    <div ng-if="monitorCtrl.radioListType == 'block'" class="col-md-3" ng-repeat="deviceinfo in monitorCtrl.deviceInfoList">
      <div class="box box-success">
        <div class="box-header">
          <h5 class="box-title" ng-if="deviceinfo.machineLicenseId">{{deviceinfo.machineLicenseId}}</h5>
          <h5 class="box-title text-gray" ng-if="deviceinfo.machineLicenseId==null">{{'undefined'|translate}}</h5>
          <div class="box-tools pull-right">
            <div class="text-gray" ng-if="deviceinfo.status == 0"> <i class="fa fa-exclamation-triangle"></i> </div>
            <div class="text-green" ng-if="deviceinfo.status == 1"> <i class="fa fa-check-square"></i> </div>
            <div class="text-yellow" ng-if="deviceinfo.status == 2"> <i class="fa fa-anchor"></i> </div>
            <div class="text-red" ng-if="deviceinfo.status == 9"> <i class="fa fa-info"></i> </div>
          </div>
        </div>
        <div class="box-body">

          <div class="row">
            <div class="col-md-5"  style="padding-left: 15px;padding-right: 0px">
              {{'machineNumberAndCarNumber'|translate}}:
            </div>
            <div class="col-md-7" style="padding-left: 0px;padding-right: 0px">
              {{deviceinfo.machineLicenseId}}
            </div>
          </div>
          <div class="row">
            <div class="col-md-5" style="padding-left: 15px;padding-right: 0px">
              {{'workingHours'|translate}}:
            </div>
            <div class="col-md-7" style="padding-left: 0px;padding-right: 0px">
              <span ng-if="deviceinfo.versionNum=='A001'">{{deviceinfo.workDuration | convertToMins}}</span>
              <span ng-if="deviceinfo.versionNum!='A001'">{{deviceinfo.totalDuration | convertToMins}}</span>
            </div>
          </div>
          <div class="row">
            <div class="col-md-5"  style="padding-left: 15px;padding-right: 0px">
              {{'terminalno'|translate}}
            </div>
            <div class="col-md-7" style="padding-left: 0px;padding-right: 0px">
              {{deviceinfo.deviceNum}}
            </div>
          </div>
          <div class="row">
            <div class="col-md-5"  style="padding-left: 15px;padding-right: 0px">
              {{'positioningState'|translate}}:
            </div>
            <div class="col-md-7" style="padding-left: 0px;padding-right: 0px">
              <span ng-class="(deviceinfo.locateStatus=='A'||deviceinfo.locateStatus=='1'||deviceinfo.locateStatus=='01')? 'text-green':'text-red'" >
                <div ng-if="deviceinfo.locateStatus=='A'||deviceinfo.locateStatus=='1'||deviceinfo.locateStatus=='01'">{{'hasBeenpositioning'|translate}}</div>
                <div ng-if="deviceinfo.locateStatus=='V'||deviceinfo.locateStatus=='0'||deviceinfo.locateStatus=='00'">{{'notLocate'|translate}}</div>
              </span>
            </div>
          </div>
          <div class="row">
            <div class="col-md-5"  style="padding-left: 15px;padding-right: 0px">
              {{'protocolType'|translate}}:
            </div>
            <div class="col-md-7" style="padding-left: 0px;padding-right: 0px">
              {{deviceinfo.protocalTypeDesc}}
            </div>
          </div>
          <div class="row">
            <div class="col-md-5"  style="padding-left: 15px;padding-right: 0px">
              {{'lastUpdateTime'|translate}}:
            </div>
            <div class="col-md-7" style="padding-left: 0px;padding-right: 0px">
              {{deviceinfo.lastUpdateTime | date:'yyyy-MM-dd HH:mm:ss'}}
            </div>
          </div>
          <div class="row">
            <div class="col-md-5"  style="padding-left: 15px;padding-right: 0px">
              {{'currentPosition'|translate}}:
            </div>
            <div class="col-md-7" style="padding-left: 0px;padding-right: 0px;min-height: 80px">
              {{deviceinfo.address}}
            </div>
          </div>
        </div>
        <div class="box-footer">
          <div class="pull-right">
            <button type="button" class="btn btn-default btn-xs" presentation-href="device:monitorPage" ng-click="monitorCtrl.currentInfo(deviceinfo.id,'lg')">{{'equipmentMonitoring'|translate}}</button>
          </div>
        </div>
      </div>
    </div>
    <!--列表模式-->
    <div class="table-responsive">
      <table ng-table="monitorCtrl.tableParams"  class="table table-condensed table-bordered table-striped text-nowrap" export-csv='csv'>
        <tr ng-repeat="deviceinfo in $data">

          <td  data-title="'terminalno'|translate" sortable="'deviceNum'" >
            <a href ng-if="monitorCtrl.validateOperPermission()" ng-click="monitorCtrl.currentInfo(deviceinfo.id,'lg')">{{deviceinfo.deviceNum}}</a>
          </td>
          <td  data-title="'machineNumberAndCarNumber'|translate" sortable="'machineLicenseId'">{{deviceinfo.machineLicenseId}}</td>
          <td  data-title="'workingHours'|translate" >
            <span ng-if="deviceinfo.versionNum=='A001'">{{deviceinfo.workDuration | convertToMins}}</span>
            <span ng-if="deviceinfo.versionNum!='A001'">{{deviceinfo.totalDuration | convertToMins}}</span>
          </td>
          <td  data-title="'machineSpeed'|translate" sortable="'gpsSpeed'">
            <span ng-if="deviceinfo.gpsSpeed==null || deviceinfo.gpsSpeed==''"></span>
            <span ng-if="deviceinfo.gpsSpeed!=null && deviceinfo.gpsSpeed!=''">{{deviceinfo.gpsSpeed |number:2}}km/h</span>
          <td  data-title="'positioningState'|translate"  sortable="'locateStatus'">
            <span ng-if="deviceinfo.locateStatus=='A' ||deviceinfo.locateStatus=='1' || deviceinfo.locateStatus=='01'">{{'hasBeenpositioning'|translate}}</span>
            <span ng-if="deviceinfo.locateStatus=='V' ||deviceinfo.locateStatus=='0' || deviceinfo.locateStatus=='00'">{{'notLocate'|translate}}</span>
          </td>
          <td  data-title="'currentPosition'|translate" style="width: 200px" ng-if="(deviceinfo.locateStatus=='A'||deviceinfo.locateStatus=='1'||deviceinfo.locateStatus=='01') && deviceinfo.address!=null">{{deviceinfo.address}}</td>
          <td  data-title="'currentPosition'|translate" style="width: 200px" ng-if="(deviceinfo.locateStatus=='V' ||deviceinfo.locateStatus=='0'||deviceinfo.locateStatus=='00') || deviceinfo.locateStatus==null || deviceinfo.address==null">--</td>
          <td  data-title="'protocolType'|translate" sortable="'versionNum'">
            <span ng-if="deviceinfo.versionNum!='A001'">{{'oreMachine'|translate}}</span>
            <span ng-if="deviceinfo.versionNum=='A001'">{{'arialVehicle'|translate}}</span>
          </td>

          <td  data-title="'organisation'|translate" sortable="'orgLabel'">{{deviceinfo.orgLabel}}</td>
          <td  data-title="'recentDataUploadTime'|translate" sortable="'lastDataUploadTime'">{{deviceinfo.lastDataUploadTime | date:'yyyy-MM-dd HH:mm:ss'}}</td>
          <td  data-title="'operation'|translate" >
            <button type="button" class="btn btn-default btn-xs" presentation-href="device:monitorPage" ng-click="monitorCtrl.currentInfo(deviceinfo.id,'lg')">{{'equipmentMonitoring'|translate}}</button>
          </td>
        </tr>
      </table>
    </div>
  </div>
  <div class="row">
  </div>
  <div class="box-footer">
    <uib-pagination total-items="monitorCtrl.page.totalElements" ng-change="monitorCtrl.queryDeviceInfo(monitorCtrl.deviceData_pagenumber-1,null,null,monitorCtrl.deviceNum)" max-size="15" ng-model="monitorCtrl.deviceData_pagenumber" items-per-page="monitorCtrl.page.size" class="pagination-sm" boundary-links="true" rotate="false"  first-text="{{'pagingHomePage' | translate}}" last-text="{{'lastPage'|translate}}" next-text="{{'nextPage'|translate}}" previous-text="{{'previousPage'|translate}}"></uib-pagination>
  </div>
  <!-- Main row -->
</section><!-- /.content -->
